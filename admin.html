<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APPä¸‹è½½é“¾æ¥ç®¡ç†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .login-section {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-form {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
        }

        .login-form h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-left: auto;
        }

        .user-info span {
            color: #666;
            font-weight: 500;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .header .user-info {
            position: absolute;
            top: 20px;
            right: 20px;
            text-align: right;
        }

        .header .user-info span {
            color: rgba(255, 255, 255, 0.9);
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .content {
            padding: 40px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 16px;
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .current-links {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .current-links h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .link-item {
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }

        .link-item strong {
            color: #667eea;
        }

        .link-item a {
            color: #666;
            text-decoration: none;
            word-break: break-all;
        }

        .link-item a:hover {
            color: #667eea;
            text-decoration: underline;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 120px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .preview-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .preview-section h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .preview-btn {
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin-right: 10px;
        }

        .preview-btn:hover {
            background: #218838;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e1e5e9;
            transition: all 0.3s;
        }

        .stat-item:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }

        .stats-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .screenshots-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .screenshot-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .screenshot-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .screenshot-info {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }

        .screenshot-actions {
            display: flex;
            gap: 5px;
            justify-content: center;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
            border-radius: 4px;
        }

        .upload-progress {
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
            display: none;
        }

        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .stats-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Form -->
        <div id="loginSection" class="login-section">
            <div class="login-form">
                <h1>ç®¡ç†å‘˜ç™»å½•</h1>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="username">ç”¨æˆ·å:</label>
                        <input type="text" id="username" name="username" required>
                    </div>
                    <div class="form-group">
                        <label for="password">å¯†ç :</label>
                        <input type="password" id="password" name="password" required>
                    </div>
                    <button type="submit" class="btn btn-primary">ç™»å½•</button>
                </form>
                <div id="loginMessage" class="message"></div>
            </div>
        </div>

        <!-- Admin Panel -->
        <div id="adminPanel" class="admin-panel" style="display: none;">
            <div class="header">
                <h1>APPä¸‹è½½é“¾æ¥ç®¡ç†</h1>
                <p>ç®¡ç†Androidå’ŒiOSåº”ç”¨çš„ä¸‹è½½é“¾æ¥</p>
                <div class="user-info">
                    <span id="welcomeUser"></span>
                    <button onclick="logout()" class="btn btn-secondary">ç™»å‡º</button>
                </div>
            </div>
        
        <div class="content">
            <div id="message-container"></div>
            
            <!-- Statistics Section -->
            <div class="current-links" id="statistics-section">
                <h3>ğŸ“Š è®¿é—®ç»Ÿè®¡</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="total-visitors">0</div>
                        <div class="stat-label">æ€»è®¿é—®é‡</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="unique-visitors">0</div>
                        <div class="stat-label">ç‹¬ç«‹è®¿å®¢æ•°</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="total-downloads">0</div>
                        <div class="stat-label">æ€»ä¸‹è½½é‡</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="android-downloads">0</div>
                        <div class="stat-label">Androidä¸‹è½½</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="ios-downloads">0</div>
                        <div class="stat-label">iOSä¸‹è½½</div>
                    </div>
                </div>
                <div class="stats-actions">
                    <button class="btn btn-secondary" onclick="loadStatistics()">ğŸ”„ åˆ·æ–°ç»Ÿè®¡</button>
                    <button class="btn btn-danger" onclick="resetStatistics()">ğŸ—‘ï¸ é‡ç½®ç»Ÿè®¡</button>
                </div>
            </div>
            
            <div class="current-links" id="current-links">
                <h3>å½“å‰ä¸‹è½½é“¾æ¥</h3>
                <div class="link-item">
                    <strong>Android:</strong> <a href="#" id="current-android" target="_blank">åŠ è½½ä¸­...</a>
                </div>
                <div class="link-item">
                    <strong>iOS:</strong> <a href="#" id="current-ios" target="_blank">åŠ è½½ä¸­...</a>
                </div>
            </div>
            
            <form id="update-form">
                <div class="form-group">
                    <label for="android-link">Androidä¸‹è½½é“¾æ¥</label>
                    <input type="url" id="android-link" name="android" placeholder="è¯·è¾“å…¥Androidåº”ç”¨ä¸‹è½½é“¾æ¥ï¼ˆå¦‚Google Playé“¾æ¥ï¼‰" required>
                </div>
                
                <div class="form-group">
                    <label for="ios-link">iOSä¸‹è½½é“¾æ¥</label>
                    <input type="url" id="ios-link" name="ios" placeholder="è¯·è¾“å…¥iOSåº”ç”¨ä¸‹è½½é“¾æ¥ï¼ˆå¦‚App Storeé“¾æ¥ï¼‰" required>
                </div>
                
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary" id="update-btn">
                        ğŸ’¾ æ›´æ–°é“¾æ¥
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="loadCurrentLinks()">
                        ğŸ”„ åˆ·æ–°
                    </button>
                </div>
            </form>
            
            <div class="current-links">
                <h3>ğŸ¨ åº”ç”¨Logoç®¡ç†</h3>
                <div class="form-group">
                    <label for="logo-upload">ä¸Šä¼ åº”ç”¨Logo</label>
                    <input type="file" id="logo-upload" accept="image/*">
                    <small style="color: #666; font-size: 14px;">æ”¯æŒJPGã€PNGæ ¼å¼ï¼Œæœ€å¤§5MBï¼Œå»ºè®®å°ºå¯¸512x512åƒç´ </small>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="uploadLogo()">
                        ğŸ“¤ ä¸Šä¼ Logo
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="loadCurrentLogo()">
                        ğŸ”„ åˆ·æ–°Logo
                    </button>
                </div>
                
                <div id="current-logo" style="margin-top: 20px; text-align: center;">
                    <!-- Current logo will be displayed here -->
                </div>
            </div>
            
            <div class="current-links">
                <h3>ğŸ“· åº”ç”¨æˆªå›¾ç®¡ç†</h3>
                <div class="form-group">
                    <label for="screenshot-upload">ä¸Šä¼ åº”ç”¨æˆªå›¾</label>
                    <input type="file" id="screenshot-upload" accept="image/*" multiple>
                    <small style="color: #666; font-size: 14px;">æ”¯æŒJPGã€PNGæ ¼å¼ï¼Œæœ€å¤§5MBï¼Œå¯é€‰æ‹©å¤šå¼ å›¾ç‰‡</small>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="uploadScreenshots()">
                        ğŸ“¤ ä¸Šä¼ æˆªå›¾
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="loadScreenshots()">
                        ğŸ”„ åˆ·æ–°æˆªå›¾
                    </button>
                </div>
                
                <div id="screenshots-grid" class="stats-grid" style="margin-top: 20px;">
                    <!-- Screenshots will be loaded here -->
                </div>
            </div>
            
            <div class="preview-section">
                <h3>é¢„è§ˆé¡µé¢</h3>
                <p>æ›´æ–°é“¾æ¥åï¼Œæ‚¨å¯ä»¥é¢„è§ˆä¸‹è½½é¡µé¢æ•ˆæœï¼š</p>
                <a href="/" class="preview-btn" target="_blank">ğŸ”— æŸ¥çœ‹ä¸‹è½½é¡µé¢</a>
            </div>
        </div>
        </div> <!-- End Admin Panel -->
    </div>

    <script>
        let currentLinks = { android: '', ios: '' };

        // Check authentication status on page load
         document.addEventListener('DOMContentLoaded', function() {
             checkAuthStatus();
         });

         // Upload screenshots function
         async function uploadScreenshots() {
             const fileInput = document.getElementById('screenshot-upload');
             const files = fileInput.files;
             
             if (files.length === 0) {
                 showMessage('è¯·é€‰æ‹©è¦ä¸Šä¼ çš„å›¾ç‰‡', 'error');
                 return;
             }
             
             for (let i = 0; i < files.length; i++) {
                 const file = files[i];
                 const formData = new FormData();
                 formData.append('screenshot', file);
                 
                 try {
                     const response = await fetch('/upload-screenshot', {
                         method: 'POST',
                         body: formData
                     });
                     
                     if (response.status === 401) {
                         showLoginForm();
                         return;
                     }
                     
                     const data = await response.json();
                     
                     if (response.ok) {
                         showMessage(`${file.name} ä¸Šä¼ æˆåŠŸ`, 'success');
                     } else {
                         showMessage(`${file.name} ä¸Šä¼ å¤±è´¥: ${data.error}`, 'error');
                     }
                 } catch (error) {
                     showMessage(`${file.name} ä¸Šä¼ å¤±è´¥`, 'error');
                 }
             }
             
             // Clear file input and reload screenshots
             fileInput.value = '';
             loadScreenshots();
         }

         // Load screenshots
         async function loadScreenshots() {
             try {
                 const response = await fetch('/screenshots');
                 
                 if (!response.ok) {
                     if (response.status === 401) {
                         showLoginForm();
                         return;
                     }
                     throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                 }
                 
                 const contentType = response.headers.get('content-type');
                 if (!contentType || !contentType.includes('application/json')) {
                     console.error('å“åº”ä¸æ˜¯JSONæ ¼å¼:', contentType);
                     const text = await response.text();
                     console.error('å“åº”å†…å®¹:', text.substring(0, 200));
                     return;
                 }
                 
                 const screenshots = await response.json();
                 
                 const grid = document.getElementById('screenshots-grid');
                 
                 if (screenshots.length === 0) {
                     grid.innerHTML = '<p style="text-align: center; color: #666; grid-column: 1 / -1;">æš‚æ— åº”ç”¨æˆªå›¾</p>';
                     return;
                 }
                 
                 grid.innerHTML = screenshots.map(screenshot => `
                     <div class="screenshot-item">
                         <img src="${screenshot.url}" alt="${screenshot.originalName}" onclick="previewImage('${screenshot.url}')">
                         <div class="screenshot-info">
                             <div>${screenshot.originalName}</div>
                             <div>${new Date(screenshot.uploadTime).toLocaleString()}</div>
                         </div>
                         <div class="screenshot-actions">
                             <button class="btn btn-danger btn-small" onclick="deleteScreenshot('${screenshot.id}')">
                                 ğŸ—‘ï¸ åˆ é™¤
                             </button>
                         </div>
                     </div>
                 `).join('');
             } catch (error) {
                 console.error('åŠ è½½æˆªå›¾å¤±è´¥:', error);
                 showMessage('åŠ è½½æˆªå›¾å¤±è´¥', 'error');
             }
         }

         // Delete screenshot
         async function deleteScreenshot(screenshotId) {
             if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™å¼ æˆªå›¾å—ï¼Ÿ')) {
                 return;
             }
             
             try {
                 const response = await fetch(`/screenshot/${screenshotId}`, {
                     method: 'DELETE'
                 });
                 
                 if (response.status === 401) {
                     showLoginForm();
                     return;
                 }
                 
                 const data = await response.json();
                 
                 if (response.ok) {
                     showMessage('æˆªå›¾åˆ é™¤æˆåŠŸ', 'success');
                     loadScreenshots();
                 } else {
                     showMessage(`åˆ é™¤å¤±è´¥: ${data.error}`, 'error');
                 }
             } catch (error) {
                 showMessage('åˆ é™¤å¤±è´¥', 'error');
             }
         }

         // Preview image
         function previewImage(url) {
             window.open(url, '_blank');
         }

         // Upload logo function
         async function uploadLogo() {
             const fileInput = document.getElementById('logo-upload');
             const file = fileInput.files[0];
             
             if (!file) {
                 showMessage('è¯·é€‰æ‹©è¦ä¸Šä¼ çš„Logoå›¾ç‰‡', 'error');
                 return;
             }
             
             const formData = new FormData();
             formData.append('logo', file);
             
             try {
                 const response = await fetch('/upload-logo', {
                     method: 'POST',
                     body: formData
                 });
                 
                 if (response.status === 401) {
                     showLoginForm();
                     return;
                 }
                 
                 const data = await response.json();
                 
                 if (response.ok) {
                     showMessage('Logoä¸Šä¼ æˆåŠŸ', 'success');
                     fileInput.value = '';
                     loadCurrentLogo();
                 } else {
                     showMessage(`Logoä¸Šä¼ å¤±è´¥: ${data.error}`, 'error');
                 }
             } catch (error) {
                 showMessage('Logoä¸Šä¼ å¤±è´¥', 'error');
             }
         }

         // Load current logo
         async function loadCurrentLogo() {
             try {
                 const logoContainer = document.getElementById('current-logo');
                 
                 // Check if logo exists
                 const response = await fetch('/uploads/logo.png');
                 
                 if (response.ok) {
                     logoContainer.innerHTML = `
                         <div style="margin-bottom: 10px;">
                             <img src="/uploads/logo.png?t=${Date.now()}" alt="å½“å‰Logo" style="max-width: 200px; max-height: 200px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                         </div>
                         <div style="color: #666; font-size: 14px;">å½“å‰Logo</div>
                         <button class="btn btn-danger btn-small" onclick="deleteLogo()" style="margin-top: 10px;">
                             ğŸ—‘ï¸ åˆ é™¤Logo
                         </button>
                     `;
                 } else {
                     logoContainer.innerHTML = '<div style="color: #666; font-size: 14px;">æš‚æ— Logo</div>';
                 }
             } catch (error) {
                 console.error('åŠ è½½Logoå¤±è´¥:', error);
             }
         }

         // Delete logo
         async function deleteLogo() {
             if (!confirm('ç¡®å®šè¦åˆ é™¤å½“å‰Logoå—ï¼Ÿ')) {
                 return;
             }
             
             try {
                 const response = await fetch('/delete-logo', {
                     method: 'DELETE'
                 });
                 
                 if (response.status === 401) {
                     showLoginForm();
                     return;
                 }
                 
                 const data = await response.json();
                 
                 if (response.ok) {
                     showMessage('Logoåˆ é™¤æˆåŠŸ', 'success');
                     loadCurrentLogo();
                 } else {
                     showMessage(`åˆ é™¤å¤±è´¥: ${data.error}`, 'error');
                 }
             } catch (error) {
                 showMessage('åˆ é™¤å¤±è´¥', 'error');
             }
         }

        // Check if user is authenticated
        async function checkAuthStatus() {
            try {
                const response = await fetch('/auth-status');
                const data = await response.json();
                
                if (data.authenticated) {
                    showAdminPanel(data.username);
                    loadCurrentLinks();
                    loadStatistics();
                } else {
                    showLoginForm();
                }
            } catch (error) {
                console.error('è®¤è¯æ£€æŸ¥å¤±è´¥:', error);
                showLoginForm();
            }
        }

        // Show login form
        function showLoginForm() {
            document.getElementById('loginSection').style.display = 'flex';
            document.getElementById('adminPanel').style.display = 'none';
        }

        // Show admin panel
         function showAdminPanel(username) {
             document.getElementById('loginSection').style.display = 'none';
             document.getElementById('adminPanel').style.display = 'block';
             document.getElementById('welcomeUser').textContent = `æ¬¢è¿, ${username}`;
             loadScreenshots();
             loadCurrentLogo();
         }

        // Handle login form submission
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            try {
                const response = await fetch('/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showLoginMessage(data.message, 'success');
                    setTimeout(() => {
                        showAdminPanel(username);
                        loadCurrentLinks();
                        loadStatistics();
                    }, 1000);
                } else {
                    showLoginMessage(data.error, 'error');
                }
            } catch (error) {
                showLoginMessage('ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
            }
        });

        // Show login message
        function showLoginMessage(text, type) {
            const messageElement = document.getElementById('loginMessage');
            messageElement.className = `message ${type}`;
            messageElement.textContent = text;
            messageElement.style.display = 'block';
        }

        // Logout function
        async function logout() {
            try {
                const response = await fetch('/logout', {
                    method: 'POST'
                });
                
                if (response.ok) {
                    showLoginForm();
                    // Clear form
                    document.getElementById('loginForm').reset();
                    document.getElementById('loginMessage').textContent = '';
                    document.getElementById('loginMessage').style.display = 'none';
                } else {
                    alert('ç™»å‡ºå¤±è´¥');
                }
            } catch (error) {
                alert('ç™»å‡ºå¤±è´¥');
            }
        }

        function loadCurrentLinks() {
            fetch('/links')
                .then(response => {
                    if (response.status === 401) {
                        showLoginForm();
                        return;
                    }
                    return response.json();
                })
                .then(data => {
                    if (data) {
                        currentLinks = data;
                        updateCurrentLinksDisplay();
                        
                        // Pre-fill form with current links
                        document.getElementById('android-link').value = data.android || '';
                        document.getElementById('ios-link').value = data.ios || '';
                    }
                })
                .catch(error => {
                    console.error('Error loading links:', error);
                    showMessage('åŠ è½½å½“å‰é“¾æ¥å¤±è´¥', 'error');
                });
        }

        function updateCurrentLinksDisplay() {
            const androidElement = document.getElementById('current-android');
            const iosElement = document.getElementById('current-ios');
            
            if (currentLinks.android) {
                androidElement.href = currentLinks.android;
                androidElement.textContent = currentLinks.android;
            } else {
                androidElement.href = '#';
                androidElement.textContent = 'æœªè®¾ç½®';
            }
            
            if (currentLinks.ios) {
                iosElement.href = currentLinks.ios;
                iosElement.textContent = currentLinks.ios;
            } else {
                iosElement.href = '#';
                iosElement.textContent = 'æœªè®¾ç½®';
            }
        }

        function showMessage(text, type) {
            const container = document.getElementById('message-container');
            const message = document.createElement('div');
            message.className = `message ${type}`;
            message.textContent = text;
            
            container.innerHTML = '';
            container.appendChild(message);
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                if (container.contains(message)) {
                    container.removeChild(message);
                }
            }, 5000);
        }

        // Handle form submission
        document.getElementById('update-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const updateBtn = document.getElementById('update-btn');
            const androidLink = document.getElementById('android-link').value.trim();
            const iosLink = document.getElementById('ios-link').value.trim();
            
            // Validate URLs
            if (!isValidUrl(androidLink) || !isValidUrl(iosLink)) {
                showMessage('è¯·è¾“å…¥æœ‰æ•ˆçš„URLé“¾æ¥', 'error');
                return;
            }
            
            // Disable button during request
            updateBtn.disabled = true;
            updateBtn.textContent = 'æ›´æ–°ä¸­...';
            
            const data = {
                android: androidLink,
                ios: iosLink
            };
            
            fetch('/update-links', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (response.status === 401) {
                    showLoginForm();
                    return;
                }
                if (response.ok) {
                    showMessage('ä¸‹è½½é“¾æ¥æ›´æ–°æˆåŠŸï¼', 'success');
                    loadCurrentLinks(); // Reload current links
                } else {
                    throw new Error('æ›´æ–°å¤±è´¥');
                }
            })
            .catch(error => {
                console.error('Error updating links:', error);
                showMessage('æ›´æ–°é“¾æ¥å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
            })
            .finally(() => {
                // Re-enable button
                updateBtn.disabled = false;
                updateBtn.textContent = 'ğŸ’¾ æ›´æ–°é“¾æ¥';
            });
        });

        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }

        // Load statistics
        function loadStatistics() {
            fetch('/statistics')
                .then(response => {
                    if (response.status === 401) {
                        showLoginForm();
                        return;
                    }
                    return response.json();
                })
                .then(data => {
                    if (data) {
                        updateStatisticsDisplay(data);
                    }
                })
                .catch(error => {
                    console.error('Error loading statistics:', error);
                    showMessage('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥', 'error');
                });
        }

        // Update statistics display
        function updateStatisticsDisplay(stats) {
            document.getElementById('total-visitors').textContent = stats.visitors || 0;
            document.getElementById('unique-visitors').textContent = stats.uniqueVisitors || 0;
            document.getElementById('total-downloads').textContent = stats.downloads.total || 0;
            document.getElementById('android-downloads').textContent = stats.downloads.android || 0;
            document.getElementById('ios-downloads').textContent = stats.downloads.ios || 0;
        }

        // Reset statistics
        function resetStatistics() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰ç»Ÿè®¡æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                fetch('/reset-statistics', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => {
                    if (response.status === 401) {
                        showLoginForm();
                        return;
                    }
                    return response.json();
                })
                .then(data => {
                    if (data && data.success) {
                        showMessage('ç»Ÿè®¡æ•°æ®å·²é‡ç½®', 'success');
                        loadStatistics(); // Reload statistics
                    } else if (data) {
                        throw new Error('é‡ç½®å¤±è´¥');
                    }
                })
                .catch(error => {
                    console.error('Error resetting statistics:', error);
                    showMessage('é‡ç½®ç»Ÿè®¡æ•°æ®å¤±è´¥', 'error');
                });
            }
        }
    </script>
</body>
</html>
